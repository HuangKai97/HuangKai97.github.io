---
layout: post
title: 从HelloWorld出发到理解微服务框架
subtitle: 程序是如何执行的
date: 2021-06-12
author: HuK
header-img: img/post-bg-universe.jpg
catalog: true
tags:
  - 程序执行
  - 抽象分层
---

## 前言

从 HelloWorld 出发迈向微服务架构，意味着从简单的单一功能函数过度到复杂的分布式系统，意味着从具体函数向更高层级的抽象迈进。本文将从执行流的角度出发简单的梳理一下二者的异同

## 正文

### 执行流

#### HelloWorld 执行顺序

顺序执行：

- 线性执行：HelloWorld 程序从上到下顺序执行，没有分支或并行处理。
- 确定性：每次执行的步骤和结果是确定的，输入和执行顺序不变。
- 简单流程：例如，Python 代码：

```
def main():
  print("Hello, World!")
if _name_ == "_main_":
  main()
```

执行流程：

1. 检查是否是主程序入口：if **name** == "**main**":。
2. 调用 main()函数。
3. 执行 main()函数中的 print("Hello, World!")语句。
4. 程序执行结束。

#### 微服务框架的执行顺序

按需执行：

- 事件驱动：微服务的执行顺序由请求和事件驱动，而不是固定的线性顺序。
- 上下文决定：每个服务的执行顺序和调用关系由输入（请求、事件）决定，服务之间的通信和数据流可能是并行或异步的。
- 复杂流程：执行流程涉及多个服务的交互，可能包含多个路径和条件分支。

某示例架构及其执行流程：
假设有一个微服务架构，包括用户服务、订单服务和支付服务，描述一个用户创建订单的流程：

```
1. 用户请求创建订单：
前端应用发送一个HTTP请求到订单服务的API端点。

2. 订单服务处理请求：
订单服务接收到请求后，调用用户服务验证用户身份。
用户服务验证完成后，订单服务创建订单记录。

3. 调用支付服务：
订单服务调用支付服务进行支付处理。
支付服务处理支付请求，并返回支付结果。

4. 订单服务更新状态：

根据支付结果，订单服务更新订单状态（如支付成功或失败）。
订单服务将最终结果返回给前端应用。

5. 前端应用展示结果：
前端应用收到订单服务的响应，并向用户展示订单创建结果。
```

#### 比较与总结

顺序执行（HelloWorld）：

- 固定流程：从头到尾按顺序执行，每次执行的路径和结果一致。
- 简单性：适合于简单任务和初学者学习基本编程概念。

按需执行（微服务框架）：

- 动态流程：执行顺序由外部输入和上下文决定，涉及多个服务的协作。
- 复杂性：适合处理复杂业务逻辑和大规模分布式系统，需要更多的设计和管理技巧。

核心区别：从执行控制来看 Hello World 控制流程明确，按预定顺序执行，而微服务框架其执行控制分散再各个服务中，是基于请求和事件驱动，按需执行。从外部依赖来看 HelloWorld 做为单体程序独立执行，而微服务框架各个服务之间相互依赖，必须管理好服务之间的通信、故障处理和数据一致性。从扩展性和灵活性角度看，HelloWorld 是单体结构，扩展性和灵活性有限。微服务框架使用的是模块化设计，高内聚低耦合，易于扩展和维护。
